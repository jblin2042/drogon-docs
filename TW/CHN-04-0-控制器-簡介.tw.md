[English](/ENG/ENG-04-0-Controller-Introduction)

# 控制器（controller）

控制器（controller）在 Web 應用開發中扮演非常重要的角色，負責處理瀏覽器送來的請求，並產生回應送回瀏覽器。drogon 框架已經幫我們處理好網路傳輸、HTTP 協定解析等細節，開發者只需專注於控制器的邏輯即可。每個控制器物件可以有一個或多個處理函式（通常稱為 handler），函式介面一般定義如下：

```c++
void handlerName(const HttpRequestPtr &req,
                   std::function<void (const HttpResponsePtr &)> &&callback,
                  ...);
```

其中，`req` 是 HTTP 請求物件（由智慧指標包裝），`callback` 是框架傳給控制器的回呼函式物件，控制器產生回應物件（同樣由智慧指標包裝）後，透過 callback 傳給 drogon，框架會自動將回應內容送回瀏覽器。最後的參數列表 `...`，由 drogon 根據映射規則將 HTTP 請求中的參數對應到 handler 的參數，這對開發非常方便。

很明顯，這是非同步介面，開發者可以在其他執行緒完成耗時操作後再呼叫 callback。

drogon 的控制器分為三種類型：`HttpSimpleController`、`HttpController` 和 `WebSocketController`。使用時需繼承對應的類別模板，例如，一個自訂的 HttpSimpleController 類別 "MyClass" 宣告如下：

```c++
class MyClass:public drogon::HttpSimpleController<MyClass>
{
public:
    //TestController(){}
    virtual void asyncHandleHttpRequest(const HttpRequestPtr &req,
                                         std::function<void (const HttpResponsePtr &)> &&callback) override;

    PATH_LIST_BEGIN
    PATH_ADD("/json");
    PATH_LIST_END
};
```

### 控制器的生命週期

註冊到 drogon 框架的控制器最多只會有一個實例，整個應用程式執行期間都不會被銷毀，因此可在控制器類別中宣告並使用成員變數。注意，控制器的 handler 被呼叫時是在多執行緒環境下（當框架 IO 執行緒數設定大於 1 時），若需存取非暫存變數，請務必做好並行保護。

# 下一步：[HttpSimpleController](/CHN/CHN-04-1-控制器-HttpSimpleController)
